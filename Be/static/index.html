<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nada Gitar - Check nada Audio</title>
    <link rel="icon" type="image/png" href="/static/logo_gitar.png">    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js" integrity="sha512-ElRFoEQdI5Ht6kZvyzXhYG9NqjtkmlkfYk0wr6wHxU9JEHakS7UJZNeml5ALk+8IKlU6jDgMabC3vkumRokgJA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        body {
            background-color: #111827; /* dark gray-900 */
            color: #f3f4f6; /* gray-100 */
        }
        
        header {
            background-color: #111827; /* dark gray-900 */
            border-bottom: 1px solid #1f2937; /* gray-800 */
        }
        
        .upload-container {
            background-color: #1f2937; /* gray-800 */
            border: 1px solid #374151; /* gray-700 */
        }
        
        .results-container {
            background-color: #1f2937; /* gray-800 */
            color: #f3f4f6; /* gray-100 */
        }
        
        .table-header {
            background-color: #374151; /* gray-700 */
        }
        
        .table-row {
            border-color: #4b5563; /* gray-600 */
        }
        
        .highlight-accent {
            color: #fbbf24; /* amber-400 */
        }
        
        .primary-button {
            background-color: #fbbf24; /* amber-400 */
            color: #1f2937; /* gray-800 */
        }
        
        .primary-button:hover {
            background-color: #f59e0b; /* amber-500 */
        }
        
        .secondary-button {
            border-color: #fbbf24; /* amber-400 */
            color: #fbbf24; /* amber-400 */
        }
        
        .secondary-button:hover {
            background-color: #fbbf24; /* amber-400 */
            color: #1f2937; /* gray-800 */
        }
        
        .info-alert {
            background-color: #1e3a8a; /* blue-900 */
            border-color: #3b82f6; /* blue-500 */
            color: #bfdbfe; /* blue-200 */
        }
        footer{
            padding: 20px;
        }
        .foots{
            padding-top: 20px;
            border-top: 2px solid white;
        }
    </style>
</head>
<body>
     
    <header class="px-6 py-4 flex justify-between items-center">
        <!-- Logo dan Judul -->
        <div class="flex items-center space-x-2">
          <a href="/" class="flex items-center space-x-2">
            <img src="/static/logo_gitar.png" alt="Logo" class="h-8 w-8" />
            <span class="text-lg font-medium font-bold">
              Nada <span class="highlight-accent">Gitar</span>
            </span>
          </a>
        </div>
    
        <!-- Navigasi -->
        <nav class="flex space-x-6">
            <a href="/" class="hover:text-amber-400 hover:underline transition duration-200 ease-in-out px-2 py-1 rounded">Home</a>
            <a href="/uploud" class="text-yellow-400 hover:text-amber-300 hover:underline transition duration-200 ease-in-out px-2 py-1 rounded">Uploud Suara</a>
            <a href="/live" class="hover:text-amber-400 hover:underline transition duration-200 ease-in-out px-2 py-1 rounded">Periksa Nada live</a>
        </nav>
    </header>

    <div class="max-w-screen-lg mx-auto mt-4 px-4">
        <h1 class="text-center mb-4 text-3xl font-bold">Audio Note & Chord <span class="highlight-accent">Analyzer</span></h1>
        
        <div class="upload-container rounded-lg p-6 shadow-md mb-6">
            <h3 class="mb-4 text-xl font-semibold">Uploud Audio File (Mp3/Wave/OGG) </h3>
            <form id="uploadForm" enctype="multipart/form-data">
                <div class="mb-4 relative">
                    <div id="dropArea" class="border-2 border-dashed border-gray-600 rounded-lg py-16 px-6 text-center cursor-pointer transition duration-300 bg-gray-700 hover:border-amber-400 hover:bg-gray-600">
                        <div class="text-gray-400 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-16 w-16" fill="currentColor" viewBox="0 0 16 16">
                                <path fill-rule="evenodd" d="M7.646 5.146a.5.5 0 0 1 .708 0l2 2a.5.5 0 0 1-.708.708L8.5 6.707V10.5a.5.5 0 0 1-1 0V6.707L6.354 7.854a.5.5 0 1 1-.708-.708l2-2z"/>
                                <path d="M4.406 3.342A5.53 5.53 0 0 1 8 2c2.69 0 4.923 2 5.166 4.579C14.758 6.804 16 8.137 16 9.773 16 11.569 14.502 13 12.687 13H3.781C1.708 13 0 11.366 0 9.318c0-1.763 1.266-3.223 2.942-3.593.143-.863.698-1.723 1.464-2.383zm.653.757c-.757.653-1.153 1.44-1.153 2.056v.448l-.445.049C2.064 6.805 1 7.952 1 9.318 1 10.785 2.23 12 3.781 12h8.906C13.98 12 15 10.988 15 9.773c0-1.216-1.02-2.228-2.313-2.228h-.5v-.5C12.188 4.825 10.328 3 8 3a4.53 4.53 0 0 0-2.941 1.1z"/>
                            </svg>
                        </div>
                        <div class="text-gray-300">
                            <h5 class="text-lg font-medium">Drag & Drop files here</h5>
                            <p class="my-2">or</p>
                             <button type="button" class="secondary-button px-4 py-2 border rounded-md transition duration-300">Browse Files</button>
                        </div>
                        <input class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" type="file" id="audioFile" accept=".mp3,.wav,.ogg">
                        <div id="fileNameDisplay" class="mt-4 font-semibold text-amber-400 hidden"></div>
                    </div>
                </div>
                
                <!-- Hidden fields - automatic segment detection is always enabled -->
                <input type="hidden" id="autoSegment" value="true">
                <input type="hidden" id="segmentDuration" value="0.5">
                
                <div class="text-center">
                    <button type="submit" class="primary-button font-semibold py-2 px-6 rounded-md transition duration-300 transform hover:-translate-y-0.5">Analyze</button>
                </div>
            </form>
            
            <div class="mt-4 info-alert border-l-4 p-4 rounded" role="alert">
                File audio dengan durasi lebih dari 5 detik dapat diproses. Waktu pemrosesan akan lebih lama untuk file yang lebih besar.
            </div>
            
            <div id="loadingIndicator" class="hidden text-center my-6">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-4 border-amber-500 border-t-transparent"></div>
                <p class="mt-3 text-gray-300">Processing audio... This may take a moment.</p>
            </div>
        </div>
        
        <div id="resultsContainer" class="results-container rounded-lg p-6 shadow-md hidden" style="margin-bottom: 20px;">
            <h3 class="text-xl font-semibold mb-4">Analysis Results</h3>
            
            <div class="mb-6">
                <audio id="audioPlayer" class="w-full mb-2" controls></audio>
                <div id="audioDurationInfo" class="text-gray-400 italic"></div>
            </div>
            
            <div class="relative h-72 mb-6">
                <canvas id="resultsChart"></canvas>
            </div>
            
            <div class="flex mb-4 space-x-4">
                <div class="flex items-center">
                    <span class="inline-block w-4 h-4 bg-amber-500 rounded mr-2"></span> 
                    <span>Notes</span>
                </div>
                <div class="flex items-center">
                    <span class="inline-block w-4 h-4 bg-emerald-500 rounded mr-2"></span> 
                    <span>Chords</span>
                </div>
            </div>
            
            <div class="h-72 overflow-y-auto">
                <table class="min-w-full divide-y divide-gray-600">
                    <thead class="table-header">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Time (s)</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Type</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Label</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Confidence</th>
                        </tr>
                    </thead>
                    <tbody id="resultsTableBody" class="divide-y divide-gray-600">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <footer class=" text-white py-12 w-full">
        <div class="container mx-auto px-6 foots">
          <div class="flex flex-col md:flex-row justify-between">
            <div class="mb-6 md:mb-0">
              <div class="flex items-center space-x-2 mb-4">
                <img src="/static/logo_gitar.png" alt="Logo" class="h-8 w-8" />
                <span class="text-lg font-medium">
                  Nada Gitar <span class="text-yellow-500">Akustik</span>
                </span>
              </div>
              <p class="text-gray-400 max-w-sm">Aplikasi pemeriksa nada gitar terbaik untuk memastikan instrumen Anda selalu terdengar sempurna.</p>
            </div>
            
            <div class="grid grid-cols-2 md:grid-cols-3 gap-8">
              <div>
                <h3 class="text-lg font-bold mb-4">Navigasi</h3>
                <ul class="space-y-2">
                  <li><a href="/" class="text-gray-400 hover:text-yellow-400 transition duration-300 " >Home</a></li>
                  <li><a href="/uploud" class="text-gray-400 hover:text-yellow-400 transition duration-300">Upload Suara</a></li>
                  <li><a href="/live" class="text-gray-400 hover:text-yellow-400 transition duration-300">Periksa Nada Live</a></li>
                </ul>
              </div>
              
              <div>
                <h3 class="text-lg font-bold mb-4">Bantuan</h3>
                <ul class="space-y-2">
                  <li><a href="#" class="text-gray-400 hover:text-yellow-400 transition duration-300">FAQ</a></li>
                  <li><a href="#" class="text-gray-400 hover:text-yellow-400 transition duration-300">Panduan Pengguna</a></li>
                  <li><a href="#" class="text-gray-400 hover:text-yellow-400 transition duration-300">Kontak</a></li>
                </ul>
              </div>
              
              <div>
                <h3 class="text-lg font-bold mb-4">Ikuti Kami</h3>
                <div class="flex space-x-4">
                  <a href="#" class="text-gray-400 hover:text-yellow-400 transition duration-300">
                    <i class="fab fa-facebook-f text-xl"></i>
                  </a>
                  <a href="#" class="text-gray-400 hover:text-yellow-400 transition duration-300">
                    <i class="fab fa-instagram text-xl"></i>
                  </a>
                  <a href="#" class="text-gray-400 hover:text-yellow-400 transition duration-300">
                    <i class="fab fa-youtube text-xl"></i>
                  </a>
                  <a href="#" class="text-gray-400 hover:text-yellow-400 transition duration-300">
                    <i class="fab fa-twitter text-xl"></i>
                  </a>
                </div>
              </div>
            </div>
          </div>
          
          <div class="border-t border-gray-800 mt-12 pt-8 flex flex-col md:flex-row justify-between items-center">
            <p class="text-gray-500">Â© 2025 Nada Gitar Akustik. Seluruh hak cipta dilindungi.</p>
            <div class="flex space-x-6 mt-4 md:mt-0">
              <a href="#" class="text-gray-500 hover:text-yellow-400 transition duration-300">Kebijakan Privasi</a>
              <a href="#" class="text-gray-500 hover:text-yellow-400 transition duration-300">Syarat dan Ketentuan</a>
            </div>
          </div>
        </div>
      </footer>
    <script>
        // Global variable for chart
        let resultsChart = null;
        
        // Handle drag and drop file upload
        document.addEventListener('DOMContentLoaded', function() {
            const dropArea = document.getElementById('dropArea');
            const fileInput = document.getElementById('audioFile');
            const fileNameDisplay = document.getElementById('fileNameDisplay');
            
            // Prevent default drag behaviors
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            // Highlight drop area when item is dragged over it
            ['dragenter', 'dragover'].forEach(eventName => {
                dropArea.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropArea.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropArea.classList.add('bg-gray-600');
                dropArea.classList.add('border-amber-400');
                dropArea.classList.remove('border-gray-600');
            }
            
            function unhighlight() {
                dropArea.classList.remove('bg-gray-600');
                dropArea.classList.remove('border-amber-400');
                dropArea.classList.add('border-gray-600');
            }
            
            // Handle dropped files
            dropArea.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                
                if (files.length) {
                    fileInput.files = files;
                    updateFileNameDisplay(files[0].name);
                }
            }
            
            // Handle file input change
            fileInput.addEventListener('change', function() {
                if (this.files.length) {
                    updateFileNameDisplay(this.files[0].name);
                }
            });
            
            function updateFileNameDisplay(fileName) {
                fileNameDisplay.textContent = 'Selected file: ' + fileName;
                fileNameDisplay.classList.remove('hidden');
            }
            
            // Make the button click trigger the file input
            dropArea.querySelector('button').addEventListener('click', function(e) {
                e.preventDefault();
                fileInput.click();
            });
        });

        function displayResults(results, audioFile, audioDuration) {
            // Set up audio player
            const audioPlayer = document.getElementById('audioPlayer');
            audioPlayer.src = URL.createObjectURL(audioFile);
            
            // Display audio duration info
            document.getElementById('audioDurationInfo').textContent = `Durasi Audio: ${audioDuration.toFixed(2)} detik`;
            
            // Prepare data for chart
            const labels = results.map(r => r.time.toFixed(2));
            const datasets = [{
                label: 'Predictions',
                data: results.map(r => {
                    return {
                        x: r.time,
                        y: r.label,
                        type: r.type
                    };
                }),
                backgroundColor: results.map(r => r.type === 'note' ? '#f59e0b' : '#10b981'), // amber-500 and emerald-500
                borderColor: results.map(r => r.type === 'note' ? '#d97706' : '#059669'), // amber-600 and emerald-600
                borderWidth: 1,
                pointRadius: 5
            }];
            
            // Create or update chart
            const ctx = document.getElementById('resultsChart').getContext('2d');
            
            if (resultsChart) {
                resultsChart.destroy();
            }
            
            // Set Chart.js default styles for dark theme
            Chart.defaults.color = '#e5e7eb'; // gray-200
            Chart.defaults.borderColor = '#4b5563'; // gray-600
            
            resultsChart = new Chart(ctx, {
                type: 'scatter',
                data: {
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            type: 'linear',
                            position: 'bottom',
                            title: {
                                display: true,
                                text: 'Time (seconds)',
                                color: '#e5e7eb' // gray-200
                            },
                            min: 0,
                            max: Math.ceil(audioDuration),
                            grid: {
                                color: '#374151' // gray-700
                            },
                            ticks: {
                                color: '#d1d5db' // gray-300
                            }
                        },
                        y: {
                            type: 'category',
                            labels: [...new Set(results.map(r => r.label))].sort(),
                            title: {
                                display: true,
                                text: 'Note/Chord',
                                color: '#e5e7eb' // gray-200
                            },
                            grid: {
                                color: '#374151' // gray-700
                            },
                            ticks: {
                                color: '#d1d5db' // gray-300
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            backgroundColor: '#1f2937', // gray-800
                            titleColor: '#f3f4f6', // gray-100
                            bodyColor: '#f3f4f6', // gray-100
                            borderColor: '#4b5563', // gray-600
                            borderWidth: 1,
                            callbacks: {
                                label: function(context) {
                                    const point = context.raw;
                                    return `Time: ${point.x.toFixed(2)}s, ${point.type}: ${point.y}`;
                                }
                            }
                        },
                        legend: {
                            display: false
                        }
                    }
                }
            });
            
            // Fill results table
            const tableBody = document.getElementById('resultsTableBody');
            tableBody.innerHTML = '';
            
            results.forEach(result => {
                const row = document.createElement('tr');
                row.className = 'table-row';
                
                const timeCell = document.createElement('td');
                timeCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-300';
                timeCell.textContent = result.time.toFixed(2);
                
                const typeCell = document.createElement('td');
                typeCell.className = 'px-6 py-4 whitespace-nowrap text-sm';
                const typeBadge = document.createElement('span');
                typeBadge.className = `inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${result.type === 'note' ? 'bg-amber-900 text-amber-200' : 'bg-emerald-900 text-emerald-200'}`;
                typeBadge.textContent = result.type.charAt(0).toUpperCase() + result.type.slice(1);
                typeCell.appendChild(typeBadge);
                
                const labelCell = document.createElement('td');
                labelCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-300';
                labelCell.textContent = result.label;
                
                const confidenceCell = document.createElement('td');
                confidenceCell.className = 'px-6 py-4 whitespace-nowrap text-sm text-gray-300';
                confidenceCell.textContent = (result.confidence * 100).toFixed(1) + '%';
                
                row.appendChild(timeCell);
                row.appendChild(typeCell);
                row.appendChild(labelCell);
                row.appendChild(confidenceCell);
                
                tableBody.appendChild(row);
            });
            
            // Show results container
            document.getElementById('resultsContainer').classList.remove('hidden');
        }
        
        // Function to show custom loading message based on file size
        function showLoadingMessage(fileSize) {
            const loadingText = document.querySelector('#loadingIndicator p');
            
            if (fileSize > 10 * 1024 * 1024) { // > 10MB
                loadingText.textContent = "Processing large audio file... This may take several minutes.";
            } else if (fileSize > 5 * 1024 * 1024) { // > 5MB
                loadingText.textContent = "Processing audio file... This may take a minute or two.";
            } else {
                loadingText.textContent = "Processing audio... This may take a moment.";
            }
        }
        
        // Form submission handler
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('uploadForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const fileInput = document.getElementById('audioFile');
                // Always use auto segmentation with fixed segment duration
                const segmentDuration = document.getElementById('segmentDuration').value;
                const autoSegment = true;
                
                if (!fileInput.files.length) {
                    alert('Please select an audio file');
                    return;
                }
                
                const file = fileInput.files[0];
                const formData = new FormData();
                formData.append('file', file);
                formData.append('segment_duration', segmentDuration);
                formData.append('auto_segment', autoSegment);
                
                // Show loading indicator with customized message based on file size
                showLoadingMessage(file.size);
                document.getElementById('loadingIndicator').classList.remove('hidden');
                document.getElementById('resultsContainer').classList.add('hidden');
                
                try {
                    const response = await fetch('/predict', {
                        method: 'POST',
                        body: formData
                    });
                    
                    if (!response.ok) {
                        const error = await response.json();
                        throw new Error(error.detail || 'Error processing audio');
                    }
                    
                    const data = await response.json();
                    displayResults(data.results, file, data.audio_duration);
                    
                } catch (error) {
                    alert('Error: ' + error.message);
                } finally {
                    document.getElementById('loadingIndicator').classList.add('hidden');
                }
            });
        });
    </script>
</body>
</html>